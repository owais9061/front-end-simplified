/**
 * Single Page Nav Plugin
 * Copyright (c) 2014 Chris Wojcik <cpw1485@gmail.com>
 * Dual licensed under MIT and GPL.
 * @author Chris Wojcik
 * @version 1.2.1
 */

// Utility
"function"!=typeof Object.create&&(Object.create=function(t){function i(){}return i.prototype=t,new i}),function(t,i,n,s){"use strict";var e={init:function(n,s){this.options=t.extend({},t.fn.singlePageNav.defaults,n),this.container=s,this.$container=t(s),this.$links=this.$container.find("a"),""!==this.options.filter&&(this.$links=this.$links.filter(this.options.filter)),this.$window=t(i),this.$htmlbody=t("html, body"),this.$links.on("click.singlePageNav",t.proxy(this.handleClick,this)),this.didScroll=!1,this.checkPosition(),this.setTimer()},handleClick:function(n){var s=this,e=n.currentTarget,o=t(e.hash),r=0;n.preventDefault(),i.innerWidth<768&&(t(".js-button-nav").trigger("click"),r=450),t(s.options.images).each(function(){var i=t(this);i.is(".loaded")||i.attr("src",i.data("src")).addClass("loaded")}),o.length&&setTimeout(function(){s.clearTimer(),"function"==typeof s.options.beforeStart&&s.options.beforeStart(),s.setActiveLink(e.hash),s.scrollTo(o,function(){s.options.updateHash&&history.pushState&&history.pushState(null,null,e.hash),s.setTimer(),"function"==typeof s.options.onComplete&&s.options.onComplete()})},r)},scrollTo:function(t,i){var n=this,s=n.getCoords(t).top,e=!1;n.$htmlbody.stop().animate({scrollTop:s},{step:(i,s)=>{var e=n.getCoords(t).top;s.end!==e&&(s.end=e)},duration:n.options.speed,easing:n.options.easing,complete:function(){"function"!=typeof i||e||i(),e=!0}})},setTimer:function(){var t=this;t.$window.on("scroll.singlePageNav",function(){t.didScroll=!0}),t.timer=setInterval(function(){t.didScroll&&(t.didScroll=!1,t.checkPosition())},250)},clearTimer:function(){clearInterval(this.timer),this.$window.off("scroll.singlePageNav"),this.didScroll=!1},checkPosition:function(){var t=this.$window.scrollTop(),i=this.getCurrentSection(t);null!==i&&this.setActiveLink(i)},getCoords:function(t){return{top:Math.round(t.offset().top)-this.options.offset}},setActiveLink:function(t){var i=this.$container.find("a[href$='"+t+"']");i.hasClass(this.options.currentClass)||(this.$links.removeClass(this.options.currentClass),i.addClass(this.options.currentClass))},getCurrentSection:function(s){var e,o,r;for(e=0;e<this.$links.length;e++)o=this.$links[e].hash,t(o).length&&s>=this.getCoords(t(o)).top-this.options.threshold&&(r=o);if(s==t(n).height()-t(i).height()){var l=this.$links.length;l>0&&(r=this.$links[l-1].hash)}return r||(0===this.$links.length?null:this.$links[0].hash)}};t.fn.singlePageNav=function(t){return this.each(function(){Object.create(e).init(t,this)})},t.fn.singlePageNav.defaults={offset:0,threshold:120,speed:400,currentClass:"current",easing:"swing",updateHash:!1,filter:"",onComplete:!1,beforeStart:!1}}(jQuery,window,document);